<?xml version="1.0" encoding="utf-8" ?>
<templates xml:space="preserve">
    <t t-inherit="mrp.BomOverviewLine" t-inherit-mode="extension" t-name="BomOverviewComponentsBlockCustom">
         <xpath expr="//td[@name='td_mrp_bom']" position="before">
             <td class="text-center" style="width: 50px;">
                <t t-if="data.product_id">
                     <img t-att-src="'/web/image/product.product/' + data.product_id + '/image_128'"
                          style="max-height:32px; max-width:32px; border-radius: 4px; cursor: pointer;"
                          t-att-alt="data.product_name"
                          t-att-title="'Click to enlarge ' + data.product_name"
                          t-on-click="() => this.openImageModal(data.product_id, data.name || data.product_name || data.display_name)"
                          onerror="this.style.display='none'; this.nextElementSibling.style.display='block';"/>

                    <span class="text-muted" style="display:none;">No Img</span>
                </t>
                 <t t-else="">
                    <span class="text-muted">No Img</span>
                </t>
            </td>

             <td t-if="props.showOptions.defaultCode" class="text-center">
        <span t-if="data.default_code" t-esc="data.default_code"/>
                 <span t-else="" class="text-muted"></span>
    </td>
             <td t-if="props.showOptions.oldEverestPn" class="text-center">
        <span t-if="data.old_everest_pn" t-esc="data.old_everest_pn"/>
                 <span t-else="" class="text-muted"></span>
    </td>

             <td t-if="data.is_evr and props.showOptions.moInternalRef" class="text-center">

                    <select t-if="data.product_manufacturer_editable"
                            class="form-select form-select-sm"
                            t-att-data-bom-line-id="data.bom_line_id"
                            t-model="data.product_manufacturer_id"
                            t-on-change="onProductManufacturerChange">

                        <option value="">Select Manufacturer Ref</option>
                        <t t-foreach="data.available_manufacturers" t-as="mref" t-key="mref.id">
                            <option t-att-value="mref.id">
                                <t t-esc="mref.ref"/>
                            </option>
                        </t>
                    </select>
                 <span t-else="" class="text-muted"></span>
                </td>
         </xpath>


        <xpath expr="//td[@t-if='showAvailabilities'][1]" position="before">
            <td t-if="data.is_evr and props.showOptions.cfeQuantity" class="text-center cfe_data">
                    <input t-if="data.cfe_editable"
                           type="text"
                           class="form-control form-control-sm cfe-quantity-input"
                           t-att-data-bom-line-id="data.bom_line_id"
                           t-model="data.cfe_quantity"
                           placeholder="CFE Qty"
                           style="width: 80px; margin: 0 auto;"
                           t-on-blur="onCfeQuantityChange"/>
                <span t-elif="data.has_cfe_quantity"
                      class="badge badge-info bg-info text-white">
                          CFE: <t t-esc="data.cfe_quantity"/>
                    </span>
                <span t-else="" class="text-muted"></span>
                </td>


            <td t-if="data.is_evr and props.showOptions.lli" class="text-center" style="display: none !important;">
                <input t-if="data.lli_editable"
                       type="checkbox"
                       class="form-check-input"
                       t-model="data.lli"
                       t-att-data-bom-line-id="data.bom_line_id"
                       t-on-change="onLliChange"/>
                <span t-elif="data.lli"
                      class="badge badge-success bg-success text-white">
                      ✓ LLI
                </span>
                <span t-else="" class="text-muted"></span>
            </td>

            <td t-if="data.is_evr and props.showOptions.approval1" class="text-center">
                <input t-if="data.approval_1_editable"
                       type="checkbox"
                       class="form-check-input"
                       t-model="data.approval_1"
                       t-att-data-bom-line-id="data.bom_line_id"
                       t-on-change="onApproval1Change"/>
                <span t-elif="data.approval_1"
                      class="badge badge-success bg-success text-white">
                      ✓ App1
                </span>
                <span t-else="" class="text-muted"></span>
            </td>

            <td t-if="data.is_evr and props.showOptions.approval2" class="text-center">
                <input t-if="data.approval_2_editable and data.can_edit_approval_2"
                       type="checkbox"
                       class="form-check-input"
                       t-model="data.approval_2"
                       t-att-data-bom-line-id="data.bom_line_id"
                       t-on-change="onApproval2Change"/>
                <input t-elif="data.approval_2_editable and !data.can_edit_approval_2"
                       type="checkbox"
                       class="form-check-input"
                       t-model="data.approval_2"
                       t-att-data-bom-line-id="data.bom_line_id"
                       disabled="1"
                       title="Only Manufacturing/Admin or Purchase/Admin can edit this field"/>
                <span t-else="" class="text-muted"></span>
            </td>

        </xpath>

    </t>
</templates>