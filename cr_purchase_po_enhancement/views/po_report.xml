<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <template id="report_purchaseorder_use_grouped_lines"
              inherit_id="purchase.report_purchaseorder_document">
        <xpath expr="//thead/tr/th[1]" position="before">
            <th class="text-center">
                <strong> שורת מספרים בדוח </strong>
            </th>
        </xpath>
        <xpath expr="//tbody" position="replace">
            <tbody>
                <t t-set="grouped_data" t-value="o.get_grouped_lines_for_report()"/>

                <t t-foreach="grouped_data" t-as="line_data">
                    <t t-set="order_line" t-value="line_data['line']"/>

                    <tr t-att-class="'fw-bold o_line_section'
                        if order_line.display_type == 'line_section'
                        else 'fst-italic o_line_note'
                        if order_line.display_type == 'line_note'
                        else ''">

                        <!-- PRODUCT LINE -->
                        <t t-if="not order_line.display_type">

                            <td class="text-center">
                                <span t-field="order_line.number_line_in_report"/>
                            </td>

                            <td class="text-start">
                                <span t-field="order_line.name"/>
                            </td>

                            <td class="text-end">
                                <span t-esc="line_data['total_qty']"/>
                                <span t-field="order_line.product_uom"
                                      groups="uom.group_uom"/>
                            </td>

                            <td class="text-end">
                                <span t-field="order_line.price_unit"/>
                            </td>

                            <td class="text-end">
                                <span t-field="order_line.discount"/>%
                            </td>

                            <td class="text-end">
                                <span t-out="', '.join([(t.invoice_label or t.name) for t in order_line.taxes_id])"/>
                            </td>

                            <td class="text-end">
                                <span t-esc="line_data['total_subtotal']"
                                      t-options='{"widget": "monetary", "display_currency": o.currency_id}'/>

                            </td>

                        </t>
                        <t t-else="">
                            <td colspan="99">
                                <span t-field="order_line.name"/>
                            </td>
                        </t>
                    </tr>
                </t>
            </tbody>
        </xpath>

    </template>
</odoo>
